---
title: "Kruskwalli_test_Dec18_2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r include=FALSE}
library(tidyverse)
library(here)
library(psych)
library(lsr)
library(ggpubr)
library(gt)
library(ggplot2)
library(lattice)
library(FSA)
```

```{r include=FALSE}
cluster_comp_gui <- readRDS(here::here("data/cluster_comp_gui_june5_scales.rds")) #5 groups
gui_cluster_data <- readRDS(here::here("data/only_gui_cluster_June4.rds")) # 4 groups
```

```{r include=FALSE}
cluster_comp_gui %>% 
  select(CNS, clusters) %>% 
  group_by(clusters) %>% 
  summarize(CNS_median=median(CNS))

cluster_comp_gui %>% 
  group_by(clusters) %>% 
  summarize(count=n())
```

## Kruskal-Wallis Test: 4 GUI groups
```{r}
# CNS
kruskal.test(CNS ~ clusters, data = gui_cluster_data) # p > 0.05 (0.747)
```

```{r}
# SOC
kruskal.test(SOC ~ clusters, data = gui_cluster_data) # p > 0.05 (0.1503)

gui_cluster_data$clusters = factor(gui_cluster_data$clusters, levels = c("1", "2", "3", "4"))

# post-hoc test - pairwise mann-whitney u-test
PT = pairwise.wilcox.test(gui_cluster_data$SOC,
                          gui_cluster_data$clusters,
                          p.adjust.method = "none")

PT
```

```{r}
library(dunn.test)
dunn.test(gui_cluster_data$SOC,
                          gui_cluster_data$clusters, method = "holm")
```

```{r}
two_groups <- gui_cluster_data %>% 
  filter(clusters==1 | clusters==2)
wilcox.test(two_groups$SOC ~ two_groups$clusters, mu = 0, alt = "two.sided", conf.int = F, conf.level = 0.95, paired = F, exact = F, correct = T)

#Just two group comparison, the difference is significant
```


```{r}
# SoCoh
kruskal.test(SoCoh ~ clusters, data = gui_cluster_data) # p > 0.05 (0.460)
```

```{r}
# Self-Est
kruskal.test(Self_Eff ~ clusters, data = gui_cluster_data) # p > 0.05 (529)

# Self-Eff
kruskal.test(Self_Est ~ clusters, data = gui_cluster_data) # p > 0.05 (0.595)

# IMI
kruskal.test(IMI ~ clusters, data = gui_cluster_data) # p > 0.05 (0.538)

# IM
kruskal.test(IM ~ clusters, data = gui_cluster_data) # p > 0.05 (0.604)

#PChoice
kruskal.test(PChoice ~ clusters, data = gui_cluster_data) # p > 0.05 (0.396)

#PComp
kruskal.test(PComp ~ clusters, data = gui_cluster_data) # p > 0.05 (0.647)
```


## Kruskal-Wallis Test: Non-GUI members VS 4 GUI groups
```{r}
# CNS
kruskal.test(CNS ~ clusters, data = cluster_comp_gui) # p < 0.05 (0.03)

cluster_comp_gui$clusters = factor(cluster_comp_gui$clusters, levels = c("1", "2", "3", "4", "5"))

# post-hoc test - pairwise mann-whitney u-test
PT = pairwise.wilcox.test(cluster_comp_gui$CNS,
                          cluster_comp_gui$clusters,
                          p.adjust.method = "holm")

PT
```

```{r}
library(dunn.test)
dunn.test(cluster_comp_gui$CNS, cluster_comp_gui$clusters, method = "holm")
```

```{r}
# Self-Eff
kruskal.test(Self_Eff ~ clusters, data = cluster_comp_gui) # p > 0.05 (0.61)

# Self-Est
kruskal.test(Self_Est ~ clusters, data = cluster_comp_gui) # p > 0.05 (0.32)
```



## Non-parametric MANOVA

### 4 groups
```{r echo=FALSE, message=FALSE}
library(vegan)
## Create the Y matrix of variables under comparison:
Y <- gui_cluster_data[, c("SOC", "SoCoh", "CNS", "IMI", "Self_Est", "Self_Eff")]
## Perform a one-way NPMANOVA:
adonis(Y ~ gui_cluster_data$clusters, method = "euclidean",
       permutations = 999)

#Not significant: 4 groups are not significantly different in terms of 6 indicators
```

### 5 groups
```{r}
Z <- cluster_comp_gui[, c("CNS", "Self_Est", "Self_Eff")]
## Perform a one-way NPMANOVA:
adonis(Z ~ cluster_comp_gui$clusters, method = "euclidean",
       permutations = 999)

#significant (around p=0.05, it fractuates slightly). 5 groups are significantly different in terms of CNS, Self-est and Self-eff
```

- by measuring several dependent variables in a single experiment, there is a better chance of discovering which factor is truly important. 

- Second, it can protect against Type I errors that might occur if multiple ANOVAâ€™s were conducted independently. Additionally, it can reveal differences not discovered by ANOVA tests.

- the dependent variables should be largely uncorrelated